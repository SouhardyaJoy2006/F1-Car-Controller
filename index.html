const contForwardBtn = document.getElementById('contForwardBtn');
const contBackwardBtn = document.getElementById('contBackwardBtn');

let continuousForwardActive = false;
let continuousBackwardActive = false;

function sendToggleCommand(togVal) {
  if (!isConnected) return;
  
  // Compose data for toggle command: DIR:STOP,SPD:0,STOP:0,BOOST:0,TOG:<togVal>
  const cmd = `DIR:STOP,SPD:0,STOP:0,BOOST:0,TOG:${togVal}`;
  
  // There's no direct writeValue for string, so encode as Uint8Array and write.
  // Alternatively, BLE characteristic may expect binary data; adjust accordingly.
  // Here assuming your BLE code handles string commands (if not, adapt).
  
  // For this example, just write a single byte TOG value as before is an example:
  bleCharacteristic.writeValueWithoutResponse(new Uint8Array([100, 100, togVal]));
}

contForwardBtn.addEventListener('click', () => {
  continuousForwardActive = !continuousForwardActive;
  if (continuousForwardActive) {
    continuousBackwardActive = false; // disable backward if forward is active
    contForwardBtn.classList.add('active');
    contBackwardBtn.classList.remove('active');
    sendToggleCommand(1);  // TOG:1 - toggle forward
  } else {
    contForwardBtn.classList.remove('active');
    sendToggleCommand(1);  // toggle off forward mode
  }
});

contBackwardBtn.addEventListener('click', () => {
  continuousBackwardActive = !continuousBackwardActive;
  if (continuousBackwardActive) {
    continuousForwardActive = false; // disable forward if backward is active
    contBackwardBtn.classList.add('active');
    contForwardBtn.classList.remove('active');
    sendToggleCommand(2);  // TOG:2 - toggle backward
  } else {
    contBackwardBtn.classList.remove('active');
    sendToggleCommand(2);  // toggle off backward mode
  }
});
